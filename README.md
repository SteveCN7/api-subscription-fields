# API Subscription Fields

[![Build Status](https://travis-ci.org/hmrc/api-subscription-fields.svg)](https://travis-ci.org/hmrc/api-subscription-fields) [ ![Download](https://api.bintray.com/packages/hmrc/releases/api-subscription-fields/images/download.svg) ](https://bintray.com/hmrc/releases/api-subscription-fields/_latestVersion)

This microservice stores definitions and values for the HMRC Developer Hub.

### Available operations for defining API subscription fields

| Endpoint                                                                      | Method   | Description                                                               | Request example                                                                                                                                                                                                                                                                                                                           | Response example                                                                                                                                                                                                                                                                                                                                                                                                              |
|-------------------------------------------------------------------------------|----------|---------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `/definition/context/:api-context/version/:api-version`                       | `PUT`    | Creates or updates the definitions of the subscriptions fields for an API | `curl -v -X PUT    "http://localhost:9650/definition/context/ciao-api/version/1.0" -H "Cache-Control: no-cache" -H "Content-Type: application/json" -d '{ "fieldDefinitions": [ { "name": "callback-url", "description": "Callback URL", "type": "URL" }, { "name": "token", "description": "Secure Token", "type": "SecureToken" } ] }'` | 200 OK / 201 Created                                                                                                                                                                                                                                                                                                                                                                                                          |
| `/definition/context/:api-context/version/:api-version` [NOT READY YET]       | `GET`    | Retrieves the definitions of subscription fields for an API               | `curl -v -X GET    "http://localhost:9650/definition/context/ciao-api/version/1.0" -H "Cache-Control: no-cache"`                                                                                                                                                                                                                          | 404 NOT_FOUND / 200 OK `{"apiContext":"ciao-api","apiVersion":"1.0","fieldDefinitions":[{"name":"callback-url","description":"Callback URL","type":"URL"},{"name":"token","description":"Secure Token","type":"SecureToken"}]}`                                                                                                                                                                                               |
| `/definition` [NOT READY YET]                                                 | `GET`    | Retrieves the definitions of subscription fields for all APIs             | `curl -v -X GET    "http://localhost:9650/definition"                              -H "Cache-Control: no-cache"`                                                                                                                                                                                                                          | 200 OK `{"apis":[{"apiContext":"ciao-api","apiVersion":"1.0","fieldDefinitions":[{"name":"callback-url","description":"Callback URL","type":"URL"},{"name":"token","description":"Secure Token","type":"SecureToken"}]},{"apiContext":"ciao-api","apiVersion":"2.0","fieldDefinitions":[{"name":"city","description":"where you live","type":"String"},{"name":"phone","description":"telephone number","type":"String"}]}]}` |
| `/definition/context/:api-context/version/:api-version` [NOT IMPLEMENTED YET] | `DELETE` | Deletes the definitions of all subscriptions fields for an API            | `curl -v -X DELETE "http://localhost:9650/definition/context/ciao-api/version/1.0" -H "Cache-Control: no-cache"`                                                                                                                                                                                                                          | 404 NOT_FOUND / 204 No Content                                                                                                                                                                                                                                                                                                                                                                                                |

### Available operations for the fields of API subscriptions

| Endpoint                                                                  | Method   | Description                                                                                    | Request example                                                                                                                                                                                                                                                                              | Response example                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|---------------------------------------------------------------------------|----------|------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `/field/application/:client-id/context/:api-context/version/:api-version` | `PUT`    | Creates or updates the field values of an API subscription                                     | `curl -v -X PUT    "http://localhost:9650/field/application/hBnFo14C0y4SckYUbcoL2PbFA40a/context/ciao-api/version/1.0" -H "Cache-Control: no-cache" -H "Content-Type: application/json" -d '{ "fields" : { "callback-url" : "http://localhost:8080/callback", "token" : "abc59609za2q" } }'` | 200 OK / 201 Created `{"clientId":"hBnFo14C0y4SckYUbcoL2PbFA40a","apiContext":"ciao-api","apiVersion":"1.0","fieldsId":"f121ffa3-df94-43a0-8235-ac4530f9700a","fields":{"callback-url":"http://localhost:8080/callback","token":"abc59609za2q"}}`                                                                                                                                                                                                                 |
| `/field/application/:client-id/context/:api-context/version/:api-version` | `GET`    | Retrieves the field values of an API subscription by providing the application and API details | `curl -v -X GET    "http://localhost:9650/field/application/hBnFo14C0y4SckYUbcoL2PbFA40a/context/ciao-api/version/1.0" -H "Cache-Control: no-cache"`                                                                                                                                         | 404 NOT_FOUND / 200 OK `{"clientId":"hBnFo14C0y4SckYUbcoL2PbFA40a","apiContext":"ciao-api","apiVersion":"1.0","fieldsId":"f121ffa3-df94-43a0-8235-ac4530f9700a","fields":{"callback-url":"http://localhost:8080/callback","token":"abc59609za2q"}}`                                                                                                                                                                                                               |
| `/field/:fieldsId`                                                        | `GET`    | Retrieves the field values of an API subscription by providing the `fieldsId`                  | `curl -v -X GET    "http://localhost:9650/field/f121ffa3-df94-43a0-8235-ac4530f9700a"                                  -H "Cache-Control: no-cache"`                                                                                                                                         | 404 NOT_FOUND / 200 OK `{"clientId":"hBnFo14C0y4SckYUbcoL2PbFA40a","apiContext":"ciao-api","apiVersion":"1.0","fieldsId":"f121ffa3-df94-43a0-8235-ac4530f9700a","fields":{"callback-url":"http://localhost:8080/callback","token":"abc59609za2q"}}`                                                                                                                                                                                                               |
| `/field/application/:client-id` [NOT READY YET]                           | `GET`    | Retrieves the field values of all API subscriptions related to a specific application          | `curl -v -X GET    "http://localhost:9650/field/application/hBnFo14C0y4SckYUbcoL2PbFA40a"                              -H "Cache-Control: no-cache"`                                                                                                                                         | 404 NOT_FOUND / 200 OK `{"subscriptions":[{"clientId":"hBnFo14C0y4SckYUbcoL2PbFA40a","apiContext":"ciao-api","apiVersion":"1.0","fieldsId":"f121ffa3-df94-43a0-8235-ac4530f9700a","fields":{"callback-url":"http://localhost:8080/callback","token":"abc59609za2q"}},{"clientId":"hBnFo14C0y4SckYUbcoL2PbFA40a","apiContext":"hello-api","apiVersion":"2.0","fieldsId":"ab1a03cf-8666-4e33-9ef7-07c172527675","fields":{"phone":"01219928876","city":"Leeds"}}]}` |
| `/field` [NOT IMPLEMENTED YET]                                            | `GET`    | Retrieves the field values of all API subscriptions                                            | `curl -v -X GET    "http://localhost:9650/field                                                                        -H "Cache-Control: no-cache"`                                                                                                                                         | 200 OK `{"subscriptions":[{"clientId":"hBnFo14C0y4SckYUbcoL2PbFA40a","apiContext":"ciao-api","apiVersion":"1.0","fieldsId":"f121ffa3-df94-43a0-8235-ac4530f9700a","fields":{"callback-url":"http://localhost:8080/callback","token":"abc59609za2q"}},{"clientId":"gGnFj14C05fScBYUbcoL3PbF540a","apiContext":"hello-api","apiVersion":"2.0","fieldsId":"ab1a03cf-8666-4e33-9ef7-07c172527675","fields":{"phone":"01219928876","city":"Leeds"}}]}`                 |
| `/field/application/:client-id/context/:api-context/version/:api-version` | `DELETE` | Deletes the field values of an API subscription                                                | `curl -v -X DELETE "http://localhost:9650/field/application/hBnFo14C0y4SckYUbcoL2PbFA40a/context/ciao-api/version/1.0" -H "Cache-Control: no-cache"`                                                                                                                                         | 404 NOT_FOUND / 204 No Content                                                                                                                                                                                                                                                                                                                                                                                                                                    |


## Tests
Some tests require MongoDB to run. 
Thus, remember to start up MongoDB if you want to run the tests locally.
There are unit tests, integration tests and acceptance tests plus code coverage reports are generated too.
In order to run them, use this command line:
```
./precheck.sh
```


### License

This code is open source software licensed under the [Apache 2.0 License]("http://www.apache.org/licenses/LICENSE-2.0.html")
